{"data":{"site":{"siteMetadata":{"title":"Mingjun Zhou's blog","author":"Mingjun Zhou","sourceUrl":"https://github.com/zhoumingjun/zhoumingjun.github.io/blob/source/","siteUrl":"https://zhoumingjun.github.io","disqusShortname":"zhoumingjun"}},"markdownRemark":{"id":"12a3ce7b-c9e6-5b3e-9df0-13d342595d55","html":"<h1>introduction</h1>\n<ul>\n<li>\n<p>lvs:<br>\n<a href=\"http://www.linuxvirtualserver.org/\">lvs</a> is a kind of L4 load balancer.<br>\nsome references here:\n[howto] (<a href=\"http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/index.html\">http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/index.html</a>)</p>\n</li>\n<li>\n<p>keepalived:<br>\n<a href=\"http://www.keepalived.org/\">keepalived</a> is a facilitator for lvs</p>\n</li>\n</ul>\n<h1>configuration</h1>\n<p>topology:</p>\n<ul>\n<li>DIP: 192.168.2.172            </li>\n<li>RIP[1]: 192.168.2.173         </li>\n<li>RIP[2]: 192.168.2.174     </li>\n<li>VIP: 192.168.2.175            </li>\n</ul>\n<h2>lvs only</h2>\n<p>director side </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#install ipvsadm\nyum -y install ipvsadm\necho &#39;net.ipv4.ip_forward = 1&#39; &gt;&gt; /etc/sysctl.conf \nsysctl -p\ntouch /etc/sysconfig/ipvsadm \nsystemctl start ipvsadm \nsystemctl enable ipvsadm \n\n# add vip\nifconfig em1:0 192.168.2.175 netmask 255.255.255.255\n\n# configuration\nipvsadm -C\nipvsadm -A -t 192.168.2,175:80 -s rr\nipvsadm -a -t 192.168.2,175:80 -r 192.168.2,173:80 -g\nipvsadm -a -t 192.168.2,175:80 -r 192.168.2,174:80 -g\nipvsadm -l </code></pre></div>\n<p>realserver side</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># add vip\nifconfig lo:0 192.168.2.175 netmask 255.255.255.255 broadcast 192.168.2.175 \n\n# disable VIP arp\necho &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore\necho &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_announce\necho &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_ignore\necho &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_announce</code></pre></div>\n<h2>lvs + keepalived</h2>\n<p>director side </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">global_defs {              \n    router_id LVS_MASTER   \n}\nvrrp_instance VI_1 {       \n    state MASTER           \n    interface em1          \n    virtual_router_id 51   \n    priority 100           \n    advert_int 1           \n    authentication {       \n    auth_type PASS\n    auth_pass 1111\n    }\nvirtual_ipaddress {        \n    192.168.2.175\n    }\n}\nvirtual_server 192.168.2.175 80 {\n    delay_loop 6            \n    lb_algo wrr             \n    lb_kind DR              \n    nat_mask 255.255.255.0  \n    #persistence_timeout 5  \n    protocol TCP            \n    real_server 192.168.2.173 80 {      \n        weight 3                   \n        TCP_CHECK {               \n        connect_timeout 5        \n        nb_get_retry 3\n        delay_before_retry 3\n        connect_port 80\n        }\n    }\n    real_server 192.168.2.174 80 {\n        weight 3\n        TCP_CHECK {\n        connect_timeout 10\n        nb_get_retry 3\n        delay_before_retry 3\n        connect_port 80\n        }\n    }\n}</code></pre></div>\n<p>realserver side</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># add vip\nifconfig lo:0 192.168.2.175 netmask 255.255.255.255 broadcast 192.168.2.175 \n\n# disable VIP arp\necho &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore\necho &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_announce\necho &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_ignore\necho &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_announce</code></pre></div>","fileAbsolutePath":"/home/zhoumingjun/github.com/zhoumingjun/zhoumingjun.github.io/content/post/2017-03-22-lvs-keepalived/index.md","fields":{"permalink":"/2017/03/22/lvs-keepalived","category":"post"},"frontmatter":{"title":"lvs keepalived","date":"March 22, 2017"}}},"pageContext":{"permalink":"/2017/03/22/lvs-keepalived","prev":{"internal":{"content":"\nI decided to migrate my blog from hugo to gatsby.\nGatsby is based on react and misc plugins, and it works in the same way as normal web development. \nBut there are still some works to do, such as mathjax support.\n\n\n\n\n"},"fields":{"fpath":"/post/2018-08-14-migrate-from-hugo-to-gatsby/","permalink":"/2018/08/14/migrate-from-hugo-to-gatsby","category":"post"},"frontmatter":{"title":"Migrate from Hugo to Gatsby","date":"2018-08-14","tags":null,"desc":null,"slug":null}},"next":{"internal":{"content":"\n# MathJax support\n## configuration\n[Hugo doc](https://gohugo.io/tutorials/mathjax/)    \n[MathJax doc](http://docs.mathjax.org/en/latest/configuration.html?#using-plain-javascript)     \n\n``` \n<!-- LaTeX math rendering -->\n{{ if  .Params.math   }}\n<script type=\"text/javascript\">\n    window.MathJax = {\n        tex2jax: {\n            inlineMath: [['$','$'], ['\\\\(','\\\\)']],\n            displayMath: [['$$','$$'], ['\\[','\\]']],\n            processEscapes: true,\n            processEnvironments: true,\n            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],\n            TeX: { equationNumbers: { autoNumber: \"AMS\" },\n                extensions: [\"AMSmath.js\", \"AMSsymbols.js\", \"color.js\"] }\n        },\n        AuthorInit: function () {\n            MathJax.Hub.Register.StartupHook(\"Begin\",function () {\n                MathJax.Hub.Queue(function() {\n                    var all = MathJax.Hub.getAllJax(), i;\n                    for(i = 0; i < all.length; i += 1) {\n                        all[i].SourceElement().parentNode.className += ' has-jax';\n                    }\n                })\n            });\n        }\n    };\n</script>\n<script  type=\"text/javascript\"\n    src=\"https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML\">\n</script>\n{{ end }}\n```\n\n## example \n**code**    \n```\n    $ v_\\pi(s) = \\sum_{a \\in \\mathcal{A}} \\pi(a|s) q_\\pi(s,a)  $\n```\n**result**  \n$ v_\\pi(s) = \\sum_{a \\in \\mathcal{A}} \\pi(a|s) q_\\pi(s,a)  $\n\n# graphviz support\n\n## configuration\n```html \n<!-- graphviz renderring -->\n{{ if  .Params.viz}}\n<script type=\"text/javascript\" src=\"//cdnjs.cloudflare.com/ajax/libs/viz.js/1.7.1/viz.js\"> </script>\n<script type=\"text/javascript\">\n(function(){\n    var vizPrefix = \"language-viz-\";\n    Array.prototype.forEach.call(document.querySelectorAll(\"[class^=\" + vizPrefix + \"]\"), function(x){\n        var engine;\n        x.getAttribute(\"class\").split(\" \").forEach(function(cls){\n            if (cls.startsWith(vizPrefix)) {\n                engine = cls.substr(vizPrefix.length);\n            }\n        });\n        var image = new DOMParser().parseFromString(Viz(x.innerText, {format:\"svg\", engine:engine}), \"image/svg+xml\");\n        x.parentNode.insertBefore(image.documentElement, x);\n        x.style.display = 'none'\n        x.parentNode.style.backgroundColor = \"white\"\n    });\n})();\n</script>\n{{ end }}\n```\n\n## example\n**code**        \n```\n    ```viz-dot\n    digraph g { \n    node[shape=\"circle\" , label=\"\", width=0.2, height=0.2]\n    l1[xlabel=\"v\\(s\\)\"]\n    l21[xlabel=\"a\", width=0.1, height=0.1 , style=filled]\n    l22[width=0.1, height=0.1, style=filled]\n    l31[xlabel=\"v\\(s'\\)\"]\n\n    l1 -> l21\n    l1 -> l22\n    l21 -> l31 [xlabel=\"r\"]\n    l21 -> l32\n    l22 -> l33\n    l22 -> l34\n    }\n    ```\n```\n**result**   \n```viz-dot\ndigraph g { \n   node[shape=\"circle\" , label=\"\", width=0.2, height=0.2]\n   l1[xlabel=\"v\\(s\\)\"]\n   l21[xlabel=\"a\", width=0.1, height=0.1 , style=filled]\n   l22[width=0.1, height=0.1, style=filled]\n   l31[xlabel=\"v\\(s'\\)\"]\n\n   l1 -> l21\n   l1 -> l22\n   l21 -> l31 [xlabel=\"r\"]\n   l21 -> l32\n   l22 -> l33\n   l22 -> l34\n}\n```"},"fields":{"fpath":"/post/2017-03-10-using-mathjax-viz-with-hugo/","permalink":"/2017/03/10/using-mathjax-and-graphviz-with-hugo","category":"post"},"frontmatter":{"title":"Using MathJax and Graphviz with Hugo","date":"2017-03-10","tags":null,"desc":null,"slug":null}}}}