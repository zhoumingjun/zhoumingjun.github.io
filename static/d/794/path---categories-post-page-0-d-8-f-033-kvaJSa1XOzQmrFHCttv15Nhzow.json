{"pageContext":{"posts":[{"internal":{"content":"\n# Overview\nTo run tensorflow/pytorch with gpu, I need to install cuda and cudnn.\nIt's really tricky, but finally I found the method. \n\nThe secret is   \n* install the graphics driver from a PPA \n* install the toolkit from the run file\n\n# packages\nThe following packages need to be installed.\n* nvidia graphics driver     \n* cuda 9.2  \n* cudnn 7.2\n\nFor nvidia graphics driver, there are two sources:\n1. raphics-drivers/ppa:     \nhttps://launchpad.net/~graphics-drivers/+archive/ubuntu/ppa         \nthe package is nvidia-driver-396\n\n2. nvidia official repo\nhttps://developer.download.nvidia.com/compute/cuda/repos/ubuntu1710/x86_64/cuda-drivers_396.44-1_amd64.deb  \nthe package is cuda-drivers\n\nIn fact the nvidia cuda-drivers is for ubuntu 17.10, and there are no official nvidia repo for ubuntu 18.04 currently.  \nHere we need to select option 1, I have try option2, but there are conflict with other packages.    \nI install the cuda-drivers with \"--force-overwrite\", but gdm can't be launched normally.\n\nFor cuda 9.2, it can be download directly from nvidia website.\n\nFor cudnn7.2, **it can be download from nvidia machine-learning repo without login**\n\n\n# installation steps\n\ninstall nvidia graphics driver  \n\n```bash \nsudo add-apt-repository ppa:graphics-drivers/ppa\nsudo apt update\nsudo apt-get install nvidia-driver-396\n```\n\ninstall cuda    \n\n```bash\n# dowload installer\naria2c https://developer.nvidia.com/compute/cuda/9.2/Prod2/local_installers/cuda_9.2.148_396.37_linux \n\naria2c https://developer.nvidia.com/compute/cuda/9.2/Prod2/patches/1/cuda_9.2.148.1_linux  \n\n# install cuda9.2 and patch\nchmod +x cuda*\n\nsudo ./cuda_9.2.148_396.37_linux.run --verbose --silent --toolkit --override\n\nsudo ./cuda_9.2.148.1_linux.run --silent --accept-eula\n\n# add to ld\nsudo echo \"/usr/local/cuda-9.2/lib64\" >> /etc/ld.so.conf\nsudo ldconfig\n```\n\ninstall cudnn   \n```bash\n#download packages\naria2c https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1604/x86_64/libcudnn7_7.2.1.38-1+cuda9.2_amd64.deb\n\naria2c https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1604/x86_64/libcudnn7-dev_7.2.1.38-1+cuda9.2_amd64.deb    \n\n# install\nsudo dpkg -i libcudnn7_7.2.1.38-1+cuda9.2_amd64.deb\nsudo dpkg -i libcudnn7-dev_7.2.1.38-1+cuda9.2_amd64.deb\n```\n"},"fields":{"slug":"/post/2018-08-23-install-cuda-and-cudnn-on-ubuntu18.04/","category":"post"},"frontmatter":{"title":"Install cuda9.2 and cudnn7.2 on ubuntu 18.04","date":"2018-08-23T15:01:49Z","tags":"ml"}},{"internal":{"content":"\nI decided to migrate my blog from hugo to gatsby.\nGatsby is based on react and misc plugins, and it works in the same way as normal web development. \nBut there are still some works to do, such as mathjax support.\n\n\n\n\n"},"fields":{"slug":"/post/2018-08-14-migrate-from-hugo-to-gatsby/","category":"post"},"frontmatter":{"title":"Migrate from Hugo to Gatsby","date":"2018-08-14T10:52:17Z","tags":"misc"}},{"internal":{"content":"\n# introduction\n- lvs:      \n  [lvs](http://www.linuxvirtualserver.org/) is a kind of L4 load balancer.              \n  some references here:\n  [howto] (http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/index.html)\n\n  \n- keepalived:       \n  [keepalived](http://www.keepalived.org/) is a facilitator for lvs\n\n# configuration\n\ntopology:\n\n- DIP: 192.168.2.172            \n- RIP[1]: 192.168.2.173         \n- RIP[2]: 192.168.2.174     \n- VIP: 192.168.2.175            \n\n## lvs only\ndirector side \n```\n#install ipvsadm\nyum -y install ipvsadm\necho 'net.ipv4.ip_forward = 1' >> /etc/sysctl.conf \nsysctl -p\ntouch /etc/sysconfig/ipvsadm \nsystemctl start ipvsadm \nsystemctl enable ipvsadm \n\n# add vip\nifconfig em1:0 192.168.2.175 netmask 255.255.255.255\n\n# configuration\nipvsadm -C\nipvsadm -A -t 192.168.2,175:80 -s rr\nipvsadm -a -t 192.168.2,175:80 -r 192.168.2,173:80 -g\nipvsadm -a -t 192.168.2,175:80 -r 192.168.2,174:80 -g\nipvsadm -l \n```\n\nrealserver side\n```\n# add vip\nifconfig lo:0 192.168.2.175 netmask 255.255.255.255 broadcast 192.168.2.175 \n\n# disable VIP arp\necho \"1\" > /proc/sys/net/ipv4/conf/lo/arp_ignore\necho \"2\" > /proc/sys/net/ipv4/conf/lo/arp_announce\necho \"1\" > /proc/sys/net/ipv4/conf/all/arp_ignore\necho \"2\" > /proc/sys/net/ipv4/conf/all/arp_announce\n```\n\n## lvs + keepalived\ndirector side \n\n```\nglobal_defs {              \n    router_id LVS_MASTER   \n}\nvrrp_instance VI_1 {       \n    state MASTER           \n    interface em1          \n    virtual_router_id 51   \n    priority 100           \n    advert_int 1           \n    authentication {       \n    auth_type PASS\n    auth_pass 1111\n    }\nvirtual_ipaddress {        \n    192.168.2.175\n    }\n}\nvirtual_server 192.168.2.175 80 {\n    delay_loop 6            \n    lb_algo wrr             \n    lb_kind DR              \n    nat_mask 255.255.255.0  \n    #persistence_timeout 5  \n    protocol TCP            \n    real_server 192.168.2.173 80 {      \n        weight 3                   \n        TCP_CHECK {               \n        connect_timeout 5        \n        nb_get_retry 3\n        delay_before_retry 3\n        connect_port 80\n        }\n    }\n    real_server 192.168.2.174 80 {\n        weight 3\n        TCP_CHECK {\n        connect_timeout 10\n        nb_get_retry 3\n        delay_before_retry 3\n        connect_port 80\n        }\n    }\n}\n```\n\nrealserver side\n```\n# add vip\nifconfig lo:0 192.168.2.175 netmask 255.255.255.255 broadcast 192.168.2.175 \n\n# disable VIP arp\necho \"1\" > /proc/sys/net/ipv4/conf/lo/arp_ignore\necho \"2\" > /proc/sys/net/ipv4/conf/lo/arp_announce\necho \"1\" > /proc/sys/net/ipv4/conf/all/arp_ignore\necho \"2\" > /proc/sys/net/ipv4/conf/all/arp_announce\n```"},"fields":{"slug":"/post/2017-03-22-lvs-keepalived/","category":"post"},"frontmatter":{"title":"lvs keepalived","date":"2017-03-22T17:23:36+08:00","tags":"devops"}},{"internal":{"content":"\n# MathJax support\n## configuration\n[Hugo doc](https://gohugo.io/tutorials/mathjax/)    \n[MathJax doc](http://docs.mathjax.org/en/latest/configuration.html?#using-plain-javascript)     \n\n``` \n<!-- LaTeX math rendering -->\n{{ if  .Params.math   }}\n<script type=\"text/javascript\">\n    window.MathJax = {\n        tex2jax: {\n            inlineMath: [['$','$'], ['\\\\(','\\\\)']],\n            displayMath: [['$$','$$'], ['\\[','\\]']],\n            processEscapes: true,\n            processEnvironments: true,\n            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],\n            TeX: { equationNumbers: { autoNumber: \"AMS\" },\n                extensions: [\"AMSmath.js\", \"AMSsymbols.js\", \"color.js\"] }\n        },\n        AuthorInit: function () {\n            MathJax.Hub.Register.StartupHook(\"Begin\",function () {\n                MathJax.Hub.Queue(function() {\n                    var all = MathJax.Hub.getAllJax(), i;\n                    for(i = 0; i < all.length; i += 1) {\n                        all[i].SourceElement().parentNode.className += ' has-jax';\n                    }\n                })\n            });\n        }\n    };\n</script>\n<script  type=\"text/javascript\"\n    src=\"https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML\">\n</script>\n{{ end }}\n```\n\n## example \n**code**    \n```\n    `$ v_\\pi(s) = \\sum_{a \\in \\mathcal{A}} \\pi(a|s) q_\\pi(s,a)  $`\n```\n**result**  \n`$ v_\\pi(s) = \\sum_{a \\in \\mathcal{A}} \\pi(a|s) q_\\pi(s,a)  $`\n\n# graphviz support\n\n## configuration\n```html \n<!-- graphviz renderring -->\n{{ if  .Params.viz}}\n<script type=\"text/javascript\" src=\"//cdnjs.cloudflare.com/ajax/libs/viz.js/1.7.1/viz.js\"> </script>\n<script type=\"text/javascript\">\n(function(){\n    var vizPrefix = \"language-viz-\";\n    Array.prototype.forEach.call(document.querySelectorAll(\"[class^=\" + vizPrefix + \"]\"), function(x){\n        var engine;\n        x.getAttribute(\"class\").split(\" \").forEach(function(cls){\n            if (cls.startsWith(vizPrefix)) {\n                engine = cls.substr(vizPrefix.length);\n            }\n        });\n        var image = new DOMParser().parseFromString(Viz(x.innerText, {format:\"svg\", engine:engine}), \"image/svg+xml\");\n        x.parentNode.insertBefore(image.documentElement, x);\n        x.style.display = 'none'\n        x.parentNode.style.backgroundColor = \"white\"\n    });\n})();\n</script>\n{{ end }}\n```\n\n## example\n**code**        \n```\n    ```viz-dot\n    digraph g { \n    node[shape=\"circle\" , label=\"\", width=0.2, height=0.2]\n    l1[xlabel=\"v\\(s\\)\"]\n    l21[xlabel=\"a\", width=0.1, height=0.1 , style=filled]\n    l22[width=0.1, height=0.1, style=filled]\n    l31[xlabel=\"v\\(s'\\)\"]\n\n    l1 -> l21\n    l1 -> l22\n    l21 -> l31 [xlabel=\"r\"]\n    l21 -> l32\n    l22 -> l33\n    l22 -> l34\n    }\n    ```\n```\n**result**   \n```viz-dot\ndigraph g { \n   node[shape=\"circle\" , label=\"\", width=0.2, height=0.2]\n   l1[xlabel=\"v\\(s\\)\"]\n   l21[xlabel=\"a\", width=0.1, height=0.1 , style=filled]\n   l22[width=0.1, height=0.1, style=filled]\n   l31[xlabel=\"v\\(s'\\)\"]\n\n   l1 -> l21\n   l1 -> l22\n   l21 -> l31 [xlabel=\"r\"]\n   l21 -> l32\n   l22 -> l33\n   l22 -> l34\n}\n```"},"fields":{"slug":"/post/2017-03-10-using-mathjax-viz-with-hugo/","category":"post"},"frontmatter":{"title":"Using MathJax and Graphviz with Hugo","date":"2017-03-10T11:40:12+08:00","tags":"math"}},{"internal":{"content":"\nI build this site to boost my daily work. \n\nThis website is powered by [Academic](https://github.com/gcushen/hugo-academic), [Hugo](https://gohugo.io), and [GitHub Pages](https://github.com/).   \n\n\n\n"},"fields":{"slug":"/post/2017-03-06-first-post/","category":"post"},"frontmatter":{"title":"First Post","date":"2017-03-06T16:03:35+08:00","tags":"misc"}}],"category":"post","pagesSum":1,"page":0}}