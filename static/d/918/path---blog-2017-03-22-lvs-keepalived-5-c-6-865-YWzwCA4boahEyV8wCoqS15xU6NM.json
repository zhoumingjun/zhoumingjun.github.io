{"data":{"site":{"siteMetadata":{"title":"zhoumingjun blog","author":"Mingjun Zhou"}},"markdownRemark":{"id":"97aba8db-ef3b-5a93-acc7-997f048b2e20","excerpt":"introduction lvs: lvs  is a kind of L4 load balancer. some references here:\n howto  ( http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/indexâ€¦","html":"<h1>introduction</h1>\n<ul>\n<li>\n<p>lvs:<br>\n<a href=\"http://www.linuxvirtualserver.org/\">lvs</a> is a kind of L4 load balancer.<br>\nsome references here:\n[howto] (<a href=\"http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/index.html\">http://www.austintek.com/LVS/LVS-HOWTO/HOWTO/index.html</a>)</p>\n</li>\n<li>\n<p>keepalived:<br>\n<a href=\"http://www.keepalived.org/\">keepalived</a> is a facilitator for lvs</p>\n</li>\n</ul>\n<h1>configuration</h1>\n<p>topology:</p>\n<ul>\n<li>DIP: 192.168.2.172            </li>\n<li>RIP[1]: 192.168.2.173         </li>\n<li>RIP[2]: 192.168.2.174     </li>\n<li>VIP: 192.168.2.175            </li>\n</ul>\n<h2>lvs only</h2>\n<p>director side </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#install ipvsadm\nyum -y install ipvsadm\necho &#39;net.ipv4.ip_forward = 1&#39; &gt;&gt; /etc/sysctl.conf \nsysctl -p\ntouch /etc/sysconfig/ipvsadm \nsystemctl start ipvsadm \nsystemctl enable ipvsadm \n\n# add vip\nifconfig em1:0 192.168.2.175 netmask 255.255.255.255\n\n# configuration\nipvsadm -C\nipvsadm -A -t 192.168.2,175:80 -s rr\nipvsadm -a -t 192.168.2,175:80 -r 192.168.2,173:80 -g\nipvsadm -a -t 192.168.2,175:80 -r 192.168.2,174:80 -g\nipvsadm -l </code></pre></div>\n<p>realserver side</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># add vip\nifconfig lo:0 192.168.2.175 netmask 255.255.255.255 broadcast 192.168.2.175 \n\n# disable VIP arp\necho &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore\necho &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_announce\necho &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_ignore\necho &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_announce</code></pre></div>\n<h2>lvs + keepalived</h2>\n<p>director side </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">global_defs {              \n    router_id LVS_MASTER   \n}\nvrrp_instance VI_1 {       \n    state MASTER           \n    interface em1          \n    virtual_router_id 51   \n    priority 100           \n    advert_int 1           \n    authentication {       \n    auth_type PASS\n    auth_pass 1111\n    }\nvirtual_ipaddress {        \n    192.168.2.175\n    }\n}\nvirtual_server 192.168.2.175 80 {\n    delay_loop 6            \n    lb_algo wrr             \n    lb_kind DR              \n    nat_mask 255.255.255.0  \n    #persistence_timeout 5  \n    protocol TCP            \n    real_server 192.168.2.173 80 {      \n        weight 3                   \n        TCP_CHECK {               \n        connect_timeout 5        \n        nb_get_retry 3\n        delay_before_retry 3\n        connect_port 80\n        }\n    }\n    real_server 192.168.2.174 80 {\n        weight 3\n        TCP_CHECK {\n        connect_timeout 10\n        nb_get_retry 3\n        delay_before_retry 3\n        connect_port 80\n        }\n    }\n}</code></pre></div>\n<p>realserver side</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># add vip\nifconfig lo:0 192.168.2.175 netmask 255.255.255.255 broadcast 192.168.2.175 \n\n# disable VIP arp\necho &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_ignore\necho &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/lo/arp_announce\necho &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_ignore\necho &quot;2&quot; &gt; /proc/sys/net/ipv4/conf/all/arp_announce</code></pre></div>","frontmatter":{"title":"lvs keepalived","date":"March 22, 2017"}}},"pageContext":{"slug":"/blog/2017-03-22-lvs-keepalived/","previous":{"fields":{"slug":"/blog/2017-03-10-using-mathjax-viz-with-hugo/"},"frontmatter":{"title":"Using MathJax and Graphviz with Hugo"}},"next":{"fields":{"slug":"/about/"},"frontmatter":{"title":"About"}}}}